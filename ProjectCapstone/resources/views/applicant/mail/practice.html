<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Calling Card Generator - Enhanced</title>
    
    <!-- External Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- AR.js for marker-based AR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ar.js/2.2.2/aframe-ar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --dark-bg: #0f0f23;
            --card-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-light: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bg-orb {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 6s ease-in-out infinite;
        }

        .orb-1 {
            width: 200px;
            height: 200px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }

        .orb-3 {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 60%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            border-radius: 12px !important;
        }

        .glass-input:focus {
            background: rgba(255, 255, 255, 0.15) !important;
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
            color: white !important;
        }

        .glass-input::placeholder {
            color: var(--text-light) !important;
        }

        .btn-gradient {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .nav-pills .nav-link {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border-radius: 15px;
            margin: 0 5px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .nav-pills .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .calling-card-modern {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        .calling-card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            pointer-events: none;
        }

        .ar-badge-modern {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: #1a1a2e;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .qr-container-modern {
            background: white;
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .file-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .work-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .work-item {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .work-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .work-item img {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .work-item video {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .ar-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ar-controls button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ar-controls button:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        .hidden {
            display: none !important;
        }

        .text-light-gray {
            color: var(--text-light);
        }

        .gradient-text {
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .icon-wrapper {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        #arScene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
        }

        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .youtube-preview {
            position: relative;
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .youtube-preview iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .portfolio-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }
    </style>
</head>

<body>
    <!-- Success Indicator -->
    <div id="updateSuccess" class="success-message hidden">
        <i class="fas fa-check me-2"></i><span id="successText">Card Updated!</span>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="bg-orb orb-1"></div>
        <div class="bg-orb orb-2"></div>
        <div class="bg-orb orb-3"></div>
    </div>

    <div class="container-fluid">
        <!-- Header -->
        <div class="row justify-content-center text-center py-5">
            <div class="col-12">
                <div class="header-content">
                    <div class="d-flex align-items-center justify-content-center gap-3 mb-4">
                        <div class="icon-wrapper">
                            <i class="fas fa-id-card-clip fs-1"></i>
                        </div>
                        <h1 class="gradient-text">AR Calling Card Generator</h1>
                    </div>
                    <p class="lead text-light-gray fs-5 mx-auto" style="max-width: 800px;">
                        Create professional AR-enabled calling cards with QR codes that showcase your portfolio in augmented reality
                    </p>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="row justify-content-center mb-5">
            <div class="col-md-8 col-lg-6">
                <ul class="nav nav-pills nav-fill" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="create-tab" data-bs-toggle="pill" data-bs-target="#create" type="button" role="tab">
                            <i class="fas fa-edit me-2"></i>Create Card
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="upload-tab" data-bs-toggle="pill" data-bs-target="#upload" type="button" role="tab">
                            <i class="fas fa-upload me-2"></i>Upload Work
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="preview-tab" data-bs-toggle="pill" data-bs-target="#preview" type="button" role="tab">
                            <i class="fas fa-eye me-2"></i>Preview
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="ar-test-tab" data-bs-toggle="pill" data-bs-target="#ar-test" type="button" role="tab">
                            <i class="fas fa-cube me-2"></i>Test AR
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Create Tab -->
            <div class="tab-pane fade show active" id="create" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="glass-card">
                            <div class="card-body p-4">
                                <h5 class="card-title text-white mb-4">
                                    <i class="fas fa-user me-2"></i>Basic Information
                                </h5>
                                <form id="cardForm">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="inputName" class="form-label">
                                                <i class="fas fa-user me-2"></i>Full Name *
                                            </label>
                                            <input type="text" class="form-control glass-input" id="inputName" 
                                                   placeholder="Your full name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inputWorkApplied" class="form-label">
                                                <i class="fas fa-briefcase me-2"></i>Position Applied *
                                            </label>
                                            <input type="text" class="form-control glass-input" id="inputWorkApplied" 
                                                   placeholder="Position you're applying for" required>
                                        </div>
                                        <div class="col-12">
                                            <label for="inputAddress" class="form-label">
                                                <i class="fas fa-map-marker-alt me-2"></i>Address *
                                            </label>
                                            <input type="text" class="form-control glass-input" id="inputAddress" 
                                                   placeholder="Your complete address" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inputEmail" class="form-label">
                                                <i class="fas fa-envelope me-2"></i>Email *
                                            </label>
                                            <input type="email" class="form-control glass-input" id="inputEmail" 
                                                   placeholder="your.email@company.com" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inputPhone" class="form-label">
                                                <i class="fas fa-phone me-2"></i>Phone Number
                                            </label>
                                            <input type="tel" class="form-control glass-input" id="inputPhone" 
                                                   placeholder="+63 912 345 6789">
                                        </div>
                                        <div class="col-12">
                                            <label for="inputSkills" class="form-label">
                                                <i class="fas fa-award me-2"></i>Skills & Expertise
                                            </label>
                                            <textarea class="form-control glass-input" id="inputSkills" rows="3" 
                                                      placeholder="List your key skills and expertise"></textarea>
                                        </div>
                                        <div class="col-12">
                                            <label for="inputYouTube" class="form-label">
                                                <i class="fab fa-youtube me-2"></i>YouTube Portfolio Video
                                            </label>
                                            <input type="url" class="form-control glass-input" id="inputYouTube" 
                                                   placeholder="https://www.youtube.com/watch?v=...">
                                        </div>
                                        <div class="col-12">
                                            <label for="inputWebsite" class="form-label">
                                                <i class="fas fa-globe me-2"></i>Portfolio Website
                                            </label>
                                            <input type="url" class="form-control glass-input" id="inputWebsite" 
                                                   placeholder="https://yourportfolio.com">
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-gradient mt-4" onclick="updatePreview()">
                                        <i class="fas fa-sync me-2"></i>Update Preview
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Work Tab -->
            <div class="tab-pane fade" id="upload" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="glass-card">
                            <div class="card-body p-4">
                                <h5 class="card-title text-white mb-4">
                                    <i class="fas fa-upload me-2"></i>Upload Your Portfolio
                                </h5>
                                
                                <!-- File Upload Area -->
                                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                                    <div class="upload-icon mb-3">
                                        <i class="fas fa-cloud-upload-alt fs-1 text-primary"></i>
                                    </div>
                                    <h6 class="text-white mb-2">Upload your sample work</h6>
                                    <p class="text-light-gray mb-3">Images, Videos, PDFs, Documents</p>
                                    <button type="button" class="btn btn-outline-light">
                                        Browse Files
                                    </button>
                                    <p class="text-light-gray mt-2 mb-0" style="font-size: 0.8rem;">
                                        Supported: JPG, PNG, MP4, PDF, DOC (Max: 50MB)
                                    </p>
                                </div>
                                
                                <input type="file" class="d-none" id="fileInput" multiple 
                                       accept="image/*,video/*,.pdf,.doc,.docx">
                                
                                <!-- Uploaded Files Preview -->
                                <div id="uploadedFiles" class="work-gallery mt-4"></div>

                                <!-- Portfolio Stats -->
                                <div class="portfolio-stats">
                                    <div class="stat-item">
                                        <div class="stat-number" id="fileCount">0</div>
                                        <div class="stat-label">Files</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number" id="imageCount">0</div>
                                        <div class="stat-label">Images</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number" id="videoCount">0</div>
                                        <div class="stat-label">Videos</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number" id="docCount">0</div>
                                        <div class="stat-label">Documents</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Tab -->
            <div class="tab-pane fade" id="preview" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="glass-card">
                            <div class="card-body">
                                <h5 class="card-title text-white mb-4">Calling Card Preview</h5>
                                
                                <div class="calling-card-modern" id="callingCardPreview">
                                    <div class="ar-badge-modern">
                                        <i class="fas fa-cube me-1"></i> AR Enabled
                                    </div>

                                    <div class="text-center mb-4">
                                        <div class="profile-avatar mx-auto">
                                            <i class="fas fa-user-tie"></i>
                                        </div>
                                        <h3 id="previewName" class="text-white mb-1">John Doe</h3>
                                        <div class="text-primary fw-bold" id="previewWorkApplied">Web Developer</div>
                                        <small class="text-light-gray">Applying for Position</small>
                                    </div>

                                    <div class="mb-4">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-map-marker-alt me-3 text-primary"></i>
                                            <span id="previewAddress" class="text-light-gray">Manila, Philippines</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-envelope me-3 text-primary"></i>
                                            <span id="previewEmail" class="text-light-gray">john@email.com</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-phone me-3 text-primary"></i>
                                            <span id="previewPhone" class="text-light-gray">+63 912 345 6789</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2" id="previewWebsiteContainer">
                                            <i class="fas fa-globe me-3 text-primary"></i>
                                            <span id="previewWebsite" class="text-light-gray">Portfolio Website</span>
                                        </div>
                                        <div class="d-flex align-items-center" id="previewYouTubeContainer">
                                            <i class="fab fa-youtube me-3 text-danger"></i>
                                            <span id="previewYouTube" class="text-light-gray">YouTube Portfolio</span>
                                        </div>
                                    </div>

                                    <div class="mb-4" id="previewSkillsContainer">
                                        <h6 class="text-white mb-2">Skills:</h6>
                                        <div id="previewSkills" class="text-light-gray">
                                            JavaScript, React, Node.js, UI/UX Design
                                        </div>
                                    </div>

                                    <!-- QR Code Section -->
                                    <div class="text-center">
                                        <h6 class="text-white mb-3">
                                            <i class="fas fa-qrcode me-2"></i>Scan for AR Portfolio
                                        </h6>
                                        <div class="qr-container-modern">
                                            <canvas id="qrCode" width="200" height="200"></canvas>
                                        </div>
                                        <small class="text-light-gray">
                                            Scan with phone camera to view portfolio in AR
                                        </small>
                                    </div>
                                </div>

                                <div class="text-center mt-4">
                                    <button class="btn btn-gradient" onclick="generateQRCode()">
                                        <i class="fas fa-qrcode me-2"></i>Generate QR Code
                                    </button>
                                    <button class="btn btn-outline-light ms-2" onclick="downloadCard()">
                                        <i class="fas fa-download me-2"></i>Download Card
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AR Test Tab -->
            <div class="tab-pane fade" id="ar-test" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="glass-card">
                            <div class="card-body p-4">
                                <h5 class="card-title text-white mb-4">
                                    <i class="fas fa-cube me-2"></i>Test AR Experience
                                </h5>
                                <p class="text-light-gray mb-4">
                                    Click "Start AR Camera" and point your camera at the QR code to see your portfolio in AR
                                </p>
                                
                                <div class="text-center">
                                    <button class="btn btn-gradient btn-lg me-3" onclick="startARCamera()">
                                        <i class="fas fa-camera me-2"></i>Start AR Camera
                                    </button>
                                    <button class="btn btn-outline-light btn-lg" onclick="showARInstructions()">
                                        <i class="fas fa-question me-2"></i>How it Works
                                    </button>
                                </div>

                                <!-- AR Instructions -->
                                <div id="arInstructions" class="mt-4 p-4 hidden" style="background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px;">
                                    <h6 class="text-white mb-3">
                                        <i class="fas fa-lightbulb me-2"></i>How AR Calling Cards Work:
                                    </h6>
                                    <ol class="text-light-gray">
                                        <li>Fill out your information and upload your portfolio files</li>
                                        <li>Generate your AR QR code with embedded portfolio data</li>
                                        <li>Print or share your calling card with the QR code</li>
                                        <li>Employers scan the QR code to access your AR portfolio</li>
                                        <li>Your portfolio appears in 3D/AR overlaying the real world</li>
                                        <li>Interactive elements allow viewing documents, images, videos</li>
                                    </ol>
                                </div>

                                <!-- AR Experience Demo -->
                                <div id="arDemo" class="mt-4 p-4 hidden" style="background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 12px;">
                                    <h6 class="text-white mb-3">
                                        <i class="fas fa-play me-2"></i>AR Experience Preview:
                                    </h6>
                                    <div class="text-center">
                                        <button class="btn btn-outline-primary me-2" onclick="previewARContent('images')">
                                            <i class="fas fa-image me-2"></i>Preview Images
                                        </button>
                                        <button class="btn btn-outline-primary me-2" onclick="previewARContent('videos')">
                                            <i class="fas fa-video me-2"></i>Preview Videos
                                        </button>
                                        <button class="btn btn-outline-primary" onclick="previewARContent('youtube')">
                                            <i class="fab fa-youtube me-2"></i>Preview YouTube
                                        </button>
                                    </div>
                                    <div id="arContentPreview" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AR Scene -->
    <a-scene id="arScene" class="hidden" embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        <a-assets>
            <!-- Dynamic assets will be added here -->
        </a-assets>
        
        <!-- AR Marker -->
        <a-marker preset="hiro" id="arMarker">
            <!-- Main Portfolio Container -->
            <a-entity id="portfolioContainer" position="0 0 0">
                <!-- Welcome Text -->
                <a-text id="welcomeText" value="Welcome to My Portfolio!" position="0 2 0" align="center" color="white" scale="1.5 1.5 1.5"></a-text>
                
                <!-- User Info Display -->
                <a-text id="userNameText" value="" position="0 1.5 0" align="center" color="#667eea" scale="1 1 1"></a-text>
                <a-text id="userPositionText" value="" position="0 1.2 0" align="center" color="#764ba2" scale="0.8 0.8 0.8"></a-text>
                
                <!-- Image Gallery Container -->
                <a-entity id="imageGallery" position="0 0.5 0" rotation="0 0 0">
                    <!-- Images will be dynamically added here -->
                </a-entity>
                
                <!-- Video Player -->
                <a-video id="portfolioVideo" position="0 0.5 0" width="3" height="2" visible="false"></a-video>
                
                <!-- YouTube Player Representation -->
                <a-plane id="youtubePlayer" position="0 0.5 0" width="3" height="2" visible="false" material="color: red; opacity: 0.8">
                    <a-text value="YouTube Video" position="0 0 0.01" align="center" color="white"></a-text>
                </a-plane>
                
                <!-- Document Viewer -->
                <a-plane id="documentViewer" position="0 0.5 0" width="2" height="3" visible="false" material="color: white; opacity: 0.9">
                    <a-text value="Document Preview" position="0 0 0.01" align="center" color="black"></a-text>
                </a-plane>
                
                <!-- Navigation Buttons -->
                <a-entity id="navButtons" position="0 -0.5 0">
                    <a-box id="prevBtn" position="-1.5 0 0" width="0.5" height="0.3" depth="0.1" color="#667eea">
                        <a-text value="< Prev" position="0 0 0.06" align="center" color="white" scale="0.8 0.8 0.8"></a-text>
                    </a-box>
                    <a-box id="nextBtn" position="1.5 0 0" width="0.5" height="0.3" depth="0.1" color="#764ba2">
                        <a-text value="Next >" position="0 0 0.06" align="center" color="white" scale="0.8 0.8 0.8"></a-text>
                    </a-box>
                </a-entity>
            </a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <!-- AR Controls -->
    <div id="arControls" class="ar-controls hidden">
        <button onclick="stopARCamera()" title="Close AR">
            <i class="fas fa-times"></i>
        </button>
        <button onclick="switchARContent('images')" title="View Images">
            <i class="fas fa-image"></i>
        </button>
        <button onclick="switchARContent('videos')" title="Play Video">
            <i class="fas fa-play"></i>
        </button>
        <button onclick="switchARContent('youtube')" title="YouTube Video">
            <i class="fab fa-youtube"></i>
        </button>
        <button onclick="switchARContent('documents')" title="View Documents">
            <i class="fas fa-file-alt"></i>
        </button>
        <button onclick="switchARContent('info')" title="User Info">
            <i class="fas fa-user"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let uploadedFiles = [];
        let currentUser = {
            name: '',
            position: '',
            address: '',
            email: '',
            phone: '',
            skills: '',
            youtube: '',
            website: ''
        };
        let arContentIndex = 0;
        let arContentType = 'images';
        let portfolioData = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updatePreview();
            setupEventListeners();
            loadSampleData(); // For demonstration purposes
        });

        // Load sample data for demonstration
        function loadSampleData() {
            document.getElementById('inputName').value = 'John Michael Doe';
            document.getElementById('inputWorkApplied').value = 'Full Stack Developer';
            document.getElementById('inputAddress').value = 'Makati City, Metro Manila, Philippines';
            document.getElementById('inputEmail').value = 'johnmichael.doe@email.com';
            document.getElementById('inputPhone').value = '+63 917 123 4567';
            document.getElementById('inputSkills').value = 'JavaScript, React, Node.js, Python, UI/UX Design, Database Management';
            document.getElementById('inputYouTube').value = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
            document.getElementById('inputWebsite').value = 'https://johndoeportfolio.com';
            
            // Create some sample files
            createSampleFiles();
            updatePreview();
        }

        // Create sample files for demonstration
        function createSampleFiles() {
            // This creates sample file objects for demonstration
            const sampleFiles = [
                { name: 'project_screenshot_1.png', type: 'image/png', size: 2048576, isDemo: true },
                { name: 'demo_video.mp4', type: 'video/mp4', size: 15728640, isDemo: true },
                { name: 'resume.pdf', type: 'application/pdf', size: 1024000, isDemo: true }
            ];
            
            sampleFiles.forEach(file => {
                uploadedFiles.push(file);
                displayUploadedFile(file);
            });
            
            updatePortfolioStats();
        }

        // Setup event listeners
        function setupEventListeners() {
            // File input handler
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            
            // Form input handlers for real-time preview updates
            const formInputs = document.querySelectorAll('#cardForm input, #cardForm textarea');
            formInputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });

            // AR Scene event listeners
            if (document.getElementById('arScene')) {
                const arScene = document.getElementById('arScene');
                
                arScene.addEventListener('arjs-video-loaded', function() {
                    console.log('AR camera loaded successfully');
                    showSuccessMessage('AR Camera Ready!');
                });
                
                arScene.addEventListener('markerFound', function() {
                    console.log('AR marker detected');
                    showSuccessMessage('AR Marker Detected! Loading portfolio...');
                    setupARContent();
                });
                
                arScene.addEventListener('markerLost', function() {
                    console.log('AR marker lost');
                });
            }
        }

        // Handle file upload
        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                if (!validateFileType(file)) {
                    showSuccessMessage(`File type ${file.type} is not supported.`, 'error');
                    return;
                }
                
                if (file.size > 50 * 1024 * 1024) { // 50MB limit
                    showSuccessMessage(`File ${file.name} is too large. Maximum size is 50MB.`, 'error');
                    return;
                }
                
                uploadedFiles.push(file);
                displayUploadedFile(file);
            });
            
            updatePortfolioStats();
            showSuccessMessage(`${files.length} file(s) uploaded successfully!`);
        }

        // Validate file type
        function validateFileType(file) {
            const allowedTypes = [
                'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp',
                'video/mp4', 'video/webm', 'video/ogg', 'video/mov',
                'application/pdf',
                'application/msword', 
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'text/plain'
            ];
            
            return allowedTypes.includes(file.type);
        }

        // Display uploaded file
        function displayUploadedFile(file) {
            const container = document.getElementById('uploadedFiles');
            const fileElement = document.createElement('div');
            fileElement.className = 'work-item';
            fileElement.setAttribute('data-filename', file.name);
            
            const fileType = file.type.split('/')[0];
            let iconClass = 'fas fa-file';
            let previewContent = '';
            
            if (fileType === 'image') {
                iconClass = 'fas fa-image';
                if (!file.isDemo) {
                    const imageUrl = URL.createObjectURL(file);
                    previewContent = `<img src="${imageUrl}" alt="${file.name}" style="max-width: 100%; height: 120px; object-fit: cover;">`;
                } else {
                    previewContent = `<div style="height: 120px; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; border-radius: 10px;">Sample Image</div>`;
                }
            } else if (fileType === 'video') {
                iconClass = 'fas fa-video';
                if (!file.isDemo) {
                    const videoUrl = URL.createObjectURL(file);
                    previewContent = `<video controls style="max-width: 100%; height: 120px;"><source src="${videoUrl}" type="${file.type}">Your browser does not support the video tag.</video>`;
                } else {
                    previewContent = `<div style="height: 120px; background: linear-gradient(45deg, #764ba2, #f093fb); display: flex; align-items: center; justify-content: center; color: white; border-radius: 10px;">Sample Video</div>`;
                }
            } else if (file.type.includes('pdf')) {
                iconClass = 'fas fa-file-pdf';
                previewContent = `<div style="height: 120px; background: #dc3545; display: flex; align-items: center; justify-content: center; color: white; border-radius: 10px; font-size: 2rem;"><i class="fas fa-file-pdf"></i></div>`;
            }
            
            fileElement.innerHTML = `
                ${previewContent}
                <i class="${iconClass} fs-2 mb-3 text-primary"></i>
                <h6 class="text-white">${file.name}</h6>
                <p class="text-light-gray">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <button class="btn btn-outline-danger btn-sm" onclick="removeFile('${file.name}')">
                    <i class="fas fa-trash"></i> Remove
                </button>
            `;
            
            container.appendChild(fileElement);
        }

        // Remove file
        function removeFile(fileName) {
            uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
            updateFileDisplay();
            updatePortfolioStats();
            showSuccessMessage('File removed successfully!');
        }

        // Update file display
        function updateFileDisplay() {
            const container = document.getElementById('uploadedFiles');
            container.innerHTML = '';
            uploadedFiles.forEach(file => displayUploadedFile(file));
        }

        // Update portfolio statistics
        function updatePortfolioStats() {
            const fileCount = uploadedFiles.length;
            const imageCount = uploadedFiles.filter(f => f.type.startsWith('image/')).length;
            const videoCount = uploadedFiles.filter(f => f.type.startsWith('video/')).length;
            const docCount = uploadedFiles.filter(f => f.type.includes('pdf') || f.type.includes('document') || f.type.includes('word')).length;

            document.getElementById('fileCount').textContent = fileCount;
            document.getElementById('imageCount').textContent = imageCount;
            document.getElementById('videoCount').textContent = videoCount;
            document.getElementById('docCount').textContent = docCount;
        }

        // Update preview
        function updatePreview() {
            // Update user data
            currentUser.name = document.getElementById('inputName').value || 'John Doe';
            currentUser.position = document.getElementById('inputWorkApplied').value || 'Web Developer';
            currentUser.address = document.getElementById('inputAddress').value || 'Manila, Philippines';
            currentUser.email = document.getElementById('inputEmail').value || 'john@email.com';
            currentUser.phone = document.getElementById('inputPhone').value || '+63 912 345 6789';
            currentUser.skills = document.getElementById('inputSkills').value || 'JavaScript, React, Node.js';
            currentUser.youtube = document.getElementById('inputYouTube').value || '';
            currentUser.website = document.getElementById('inputWebsite').value || '';

            // Update preview elements
            document.getElementById('previewName').textContent = currentUser.name;
            document.getElementById('previewWorkApplied').textContent = currentUser.position;
            document.getElementById('previewAddress').textContent = currentUser.address;
            document.getElementById('previewEmail').textContent = currentUser.email;
            document.getElementById('previewPhone').textContent = currentUser.phone;
            document.getElementById('previewSkills').textContent = currentUser.skills;

            // Update website and YouTube links
            const websiteContainer = document.getElementById('previewWebsiteContainer');
            const youtubeContainer = document.getElementById('previewYouTubeContainer');
            
            if (currentUser.website) {
                websiteContainer.style.display = 'flex';
                document.getElementById('previewWebsite').textContent = currentUser.website;
            } else {
                websiteContainer.style.display = 'none';
            }

            if (currentUser.youtube) {
                youtubeContainer.style.display = 'flex';
                document.getElementById('previewYouTube').textContent = 'YouTube Portfolio';
            } else {
                youtubeContainer.style.display = 'none';
            }

            // Update portfolio data
            portfolioData = {
                user: currentUser,
                files: uploadedFiles.map(file => ({
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    url: file.isDemo ? `demo_${file.name}` : (file instanceof File ? URL.createObjectURL(file) : file.url)
                })),
                timestamp: new Date().toISOString()
            };
        }

        // Generate QR Code with embedded portfolio data
        function generateQRCode() {
            if (!portfolioData) {
                updatePreview();
            }

            // Create a unique portfolio ID (in real app, this would be from your database)
            const portfolioId = btoa(currentUser.email + Date.now()).replace(/[^a-zA-Z0-9]/g, '').substring(0, 10);
            
            // Create AR-enabled URL with portfolio data
            const arUrl = createARPortfolioURL(portfolioId, portfolioData);
            
            try {
                const qr = new QRious({
                    element: document.getElementById('qrCode'),
                    value: arUrl,
                    size: 200,
                    background: 'white',
                    foreground: '#1a1a2e',
                    level: 'H' // High error correction for better scanning
                });

                showSuccessMessage('AR QR Code generated successfully!');
                console.log('Generated QR Code URL:', arUrl);
            } catch (error) {
                console.error('Error generating QR code:', error);
                showSuccessMessage('Error generating QR code. Please try again.', 'error');
            }
        }

        // Create AR Portfolio URL
        function createARPortfolioURL(portfolioId, data) {
            // In a real application, you would save this data to your database
            // and return a URL to your AR viewer page
            
            // For demonstration, we'll create a data URL
            const encodedData = encodeURIComponent(JSON.stringify(data));
            
            // This would be your actual AR viewer URL in production
            // return `https://yourdomain.com/ar-portfolio/${portfolioId}`;
            
            // For demo purposes, return a URL with embedded data
            return `${window.location.origin}${window.location.pathname}?ar=${portfolioId}&data=${encodedData}`;
        }

        // AR Camera Functions
        function startARCamera() {
            const arScene = document.getElementById('arScene');
            const arControls = document.getElementById('arControls');
            
            arScene.classList.remove('hidden');
            arControls.classList.remove('hidden');
            
            // Initialize AR with uploaded content
            setTimeout(() => {
                setupARContent();
            }, 1000);
        }

        function stopARCamera() {
            const arScene = document.getElementById('arScene');
            const arControls = document.getElementById('arControls');
            
            arScene.classList.add('hidden');
            arControls.classList.add('hidden');
        }

        // Setup AR Content
        function setupARContent() {
            if (!portfolioData) {
                updatePreview();
            }

            // Update user info in AR
            const userNameText = document.getElementById('userNameText');
            const userPositionText = document.getElementById('userPositionText');
            
            if (userNameText) {
                userNameText.setAttribute('value', currentUser.name);
            }
            if (userPositionText) {
                userPositionText.setAttribute('value', currentUser.position);
            }

            // Setup image gallery
            setupARImages();
            
            // Setup video content
            setupARVideos();
            
            // Setup YouTube content
            setupARYouTube();
            
            // Show initial content
            switchARContent('images');
        }

        // Setup AR Images
        function setupARImages() {
            const imageGallery = document.getElementById('imageGallery');
            if (!imageGallery) return;

            // Clear existing images
            while (imageGallery.firstChild) {
                imageGallery.removeChild(imageGallery.firstChild);
            }
            
            const imageFiles = uploadedFiles.filter(file => file.type.startsWith('image/'));
            
            imageFiles.forEach((file, index) => {
                const imageElement = document.createElement('a-plane');
                
                if (file.isDemo) {
                    // For demo files, create a colored plane
                    imageElement.setAttribute('material', `color: #${Math.floor(Math.random()*16777215).toString(16)}; opacity: 0.8`);
                    imageElement.setAttribute('geometry', 'primitive: plane; width: 1.5; height: 1');
                } else {
                    const imageUrl = URL.createObjectURL(file);
                    imageElement.setAttribute('material', `src: ${imageUrl}`);
                    imageElement.setAttribute('geometry', 'primitive: plane; width: 1.5; height: 1');
                }
                
                imageElement.setAttribute('position', `${index * 2 - 1} 0 0`);
                imageElement.setAttribute('visible', index === 0 ? 'true' : 'false');
                imageElement.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 20000');
                
                // Add text label
                const textElement = document.createElement('a-text');
                textElement.setAttribute('value', file.name);
                textElement.setAttribute('position', '0 -0.8 0');
                textElement.setAttribute('align', 'center');
                textElement.setAttribute('color', 'white');
                textElement.setAttribute('scale', '0.5 0.5 0.5');
                
                imageElement.appendChild(textElement);
                imageGallery.appendChild(imageElement);
            });
        }

        // Setup AR Videos
        function setupARVideos() {
            const portfolioVideo = document.getElementById('portfolioVideo');
            if (!portfolioVideo) return;

            const videoFiles = uploadedFiles.filter(file => file.type.startsWith('video/'));
            
            if (videoFiles.length > 0) {
                const firstVideo = videoFiles[0];
                if (!firstVideo.isDemo) {
                    const videoUrl = URL.createObjectURL(firstVideo);
                    portfolioVideo.setAttribute('src', videoUrl);
                } else {
                    // For demo, set a placeholder
                    portfolioVideo.setAttribute('material', 'color: #764ba2; opacity: 0.8');
                }
            }
        }

        // Setup AR YouTube
        function setupARYouTube() {
            const youtubePlayer = document.getElementById('youtubePlayer');
            if (!youtubePlayer || !currentUser.youtube) return;

            // Extract YouTube video ID
            const videoId = extractYouTubeVideoId(currentUser.youtube);
            if (videoId) {
                // In a real implementation, you might display a thumbnail or embed
                youtubePlayer.setAttribute('material', 'color: red; opacity: 0.9');
                
                const textElement = youtubePlayer.querySelector('a-text');
                if (textElement) {
                    textElement.setAttribute('value', 'YouTube: ' + videoId);
                }
            }
        }

        // Extract YouTube Video ID
        function extractYouTubeVideoId(url) {
            const regex = /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // Switch AR Content
        function switchARContent(type) {
            const imageGallery = document.getElementById('imageGallery');
            const portfolioVideo = document.getElementById('portfolioVideo');
            const youtubePlayer = document.getElementById('youtubePlayer');
            const documentViewer = document.getElementById('documentViewer');
            const welcomeText = document.getElementById('welcomeText');
            
            // Hide all content first
            if (imageGallery) imageGallery.setAttribute('visible', 'false');
            if (portfolioVideo) portfolioVideo.setAttribute('visible', 'false');
            if (youtubePlayer) youtubePlayer.setAttribute('visible', 'false');
            if (documentViewer) documentViewer.setAttribute('visible', 'false');
            
            arContentType = type;
            
            // Show selected content type
            switch(type) {
                case 'images':
                    if (imageGallery) {
                        imageGallery.setAttribute('visible', 'true');
                        if (welcomeText) welcomeText.setAttribute('value', 'Portfolio Images');
                    }
                    break;
                case 'videos':
                    if (portfolioVideo) {
                        portfolioVideo.setAttribute('visible', 'true');
                        if (welcomeText) welcomeText.setAttribute('value', 'Portfolio Videos');
                        // Auto-play video if it's a real file
                        const video = portfolioVideo.components.material?.material?.map?.image;
                        if (video && video.play) {
                            video.play();
                        }
                    }
                    break;
                case 'youtube':
                    if (youtubePlayer && currentUser.youtube) {
                        youtubePlayer.setAttribute('visible', 'true');
                        if (welcomeText) welcomeText.setAttribute('value', 'YouTube Portfolio');
                    }
                    break;
                case 'documents':
                    if (documentViewer) {
                        documentViewer.setAttribute('visible', 'true');
                        if (welcomeText) welcomeText.setAttribute('value', 'Documents & Resume');
                    }
                    break;
                case 'info':
                    // Show user information
                    if (welcomeText) {
                        welcomeText.setAttribute('value', `${currentUser.name} - ${currentUser.position}`);
                    }
                    break;
            }
            
            showSuccessMessage(`Switched to ${type} view`);
        }

        // Preview AR Content (for demo tab)
        function previewARContent(type) {
            const previewContainer = document.getElementById('arContentPreview');
            let content = '';
            
            switch(type) {
                case 'images':
                    const imageFiles = uploadedFiles.filter(f => f.type.startsWith('image/'));
                    content = `<h6 class="text-white mt-3">Images in AR (${imageFiles.length}):</h6>`;
                    imageFiles.forEach(file => {
                        content += `<p class="text-light-gray">• ${file.name}</p>`;
                    });
                    break;
                case 'videos':
                    const videoFiles = uploadedFiles.filter(f => f.type.startsWith('video/'));
                    content = `<h6 class="text-white mt-3">Videos in AR (${videoFiles.length}):</h6>`;
                    videoFiles.forEach(file => {
                        content += `<p class="text-light-gray">• ${file.name}</p>`;
                    });
                    break;
                case 'youtube':
                    content = `<h6 class="text-white mt-3">YouTube Video in AR:</h6>`;
                    if (currentUser.youtube) {
                        content += `<p class="text-light-gray">• ${currentUser.youtube}</p>`;
                        const videoId = extractYouTubeVideoId(currentUser.youtube);
                        if (videoId) {
                            content += `<div class="youtube-preview"><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe></div>`;
                        }
                    } else {
                        content += `<p class="text-light-gray">No YouTube video added yet.</p>`;
                    }
                    break;
            }
            
            previewContainer.innerHTML = content;
        }

        // Show AR Instructions
        function showARInstructions() {
            const instructions = document.getElementById('arInstructions');
            const demo = document.getElementById('arDemo');
            instructions.classList.toggle('hidden');
            demo.classList.remove('hidden');
        }

        // Download Card
        function downloadCard() {
            // Create a canvas for the calling card
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 1000;
            canvas.height = 600;
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(0.5, '#16213e');
            gradient.addColorStop(1, '#0f3460');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add border
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
            
            // Add AR badge
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(canvas.width - 120, 20, 100, 30);
            ctx.fillStyle = '#1a1a2e';
            ctx.font = 'bold 14px Inter';
            ctx.fillText('AR Enabled', canvas.width - 110, 40);
            
            // Add user info
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Inter';
            ctx.fillText(currentUser.name, 50, 100);
            
            ctx.font = '24px Inter';
            ctx.fillStyle = '#667eea';
            ctx.fillText(currentUser.position, 50, 140);
            
            ctx.font = '18px Inter';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText(currentUser.email, 50, 180);
            ctx.fillText(currentUser.phone, 50, 210);
            ctx.fillText(currentUser.address, 50, 240);
            
            // Add skills
            ctx.font = 'bold 20px Inter';
            ctx.fillStyle = 'white';
            ctx.fillText('Skills:', 50, 300);
            
            ctx.font = '16px Inter';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            const skillsLines = wrapText(ctx, currentUser.skills, 50, 330, 400, 20);
            
            // Add QR code placeholder (you would draw the actual QR code here)
            ctx.fillStyle = 'white';
            ctx.fillRect(canvas.width - 220, canvas.height - 220, 200, 200);
            ctx.fillStyle = '#1a1a2e';
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('QR Code', canvas.width - 120, canvas.height - 110);
            ctx.fillText('Scan for AR', canvas.width - 120, canvas.height - 90);
            
            // Download
            const link = document.createElement('a');
            link.download = `${currentUser.name.replace(/\s+/g, '_')}_AR_calling_card.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showSuccessMessage('Calling card downloaded successfully!');
        }

        // Helper function to wrap text
        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let currentY = y;

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && n > 0) {
                    ctx.fillText(line, x, currentY);
                    line = words[n] + ' ';
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, currentY);
            return currentY;
        }

        // Show success message
        function showSuccessMessage(message, type = 'success') {
            const successDiv = document.getElementById('updateSuccess');
            const successText = document.getElementById('successText');
            
            successText.textContent = message;
            
            // Change color based on type
            if (type === 'error') {
                successDiv.style.background = '#dc3545';
            } else {
                successDiv.style.background = '#28a745';
            }
            
            successDiv.classList.remove('hidden');
            
            setTimeout(() => {
                successDiv.classList.add('hidden');
            }, 3000);
        }

        // Database Integration Functions (Backend API calls)
        // These would connect to your Laravel backend

        async function savePortfolioToDatabase() {
            const formData = new FormData();
            
            // Add user data
            formData.append('user_data', JSON.stringify(currentUser));
            
            // Add files
            uploadedFiles.forEach((file, index) => {
                if (file instanceof File) {
                    formData.append(`files[${index}]`, file);
                } else {
                    // For demo files, send metadata
                    formData.append(`demo_files[${index}]`, JSON.stringify(file));
                }
            });

            try {
                const response = await fetch('/api/save-portfolio', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || 'demo'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccessMessage('Portfolio saved to database successfully!');
                    return result.portfolio_id;
                } else {
                    throw new Error('Failed to save portfolio');
                }
            } catch (error) {
                console.error('Error saving portfolio:', error);
                showSuccessMessage('Error saving portfolio. Using local storage instead.', 'error');
                
                // Fallback to local storage for demo
                const portfolioId = 'demo_' + Date.now();
                const portfolioData = {
                    id: portfolioId,
                    user: currentUser,
                    files: uploadedFiles,
                    created_at: new Date().toISOString()
                };
                
                // Note: In a real application, you wouldn't use localStorage in artifacts
                // This is just for demonstration of the data structure
                console.log('Portfolio data that would be saved:', portfolioData);
                
                return portfolioId;
            }
        }

        async function generateQRCodeWithDatabase() {
            try {
                // Save portfolio to database first
                const portfolioId = await savePortfolioToDatabase();
                
                if (!portfolioId) {
                    throw new Error('Failed to save portfolio');
                }
                
                // Generate QR code with database ID
                const arUrl = `${window.location.origin}/ar-view/${portfolioId}`;
                
                const qr = new QRious({
                    element: document.getElementById('qrCode'),
                    value: arUrl,
                    size: 200,
                    background: 'white',
                    foreground: '#1a1a2e',
                    level: 'H'
                });

                showSuccessMessage('QR Code generated with database integration!');
                console.log('Portfolio ID:', portfolioId);
                console.log('AR URL:', arUrl);
                
                return { portfolioId, arUrl };
            } catch (error) {
                console.error('Error generating QR code with database:', error);
                // Fallback to local QR code generation
                generateQRCode();
            }
        }

        // Load Portfolio from Database (for employers scanning QR codes)
        async function loadPortfolioFromDatabase(portfolioId) {
            try {
                const response = await fetch(`/api/portfolio/${portfolioId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const portfolioData = await response.json();
                    return portfolioData;
                } else {
                    throw new Error('Portfolio not found');
                }
            } catch (error) {
                console.error('Error loading portfolio:', error);
                return null;
            }
        }

        // Enhanced QR Code generation with full integration
        async function generateAdvancedQRCode() {
            showSuccessMessage('Generating advanced QR code...', 'info');
            
            try {
                // First update the preview to ensure data is current
                updatePreview();
                
                // Save to database
                const result = await generateQRCodeWithDatabase();
                
                if (result) {
                    showSuccessMessage('Advanced AR QR Code generated successfully!');
                    
                    // Log the data for debugging
                    console.log('Generated AR experience with:', {
                        portfolioId: result.portfolioId,
                        userInfo: currentUser,
                        filesCount: uploadedFiles.length,
                        arUrl: result.arUrl
                    });
                }
            } catch (error) {
                console.error('Error generating advanced QR code:', error);
                showSuccessMessage('Error generating advanced QR code. Please try again.', 'error');
            }
        }

        // Check if URL contains AR portfolio data (for scanning QR codes)
        function checkForARData() {
            const urlParams = new URLSearchParams(window.location.search);
            const arId = urlParams.get('ar');
            const arData = urlParams.get('data');
            
            if (arId && arData) {
                try {
                    const portfolioData = JSON.parse(decodeURIComponent(arData));
                    loadARPortfolio(portfolioData);
                    return true;
                } catch (error) {
                    console.error('Error parsing AR data:', error);
                }
            } else if (arId) {
                // Load from database
                loadPortfolioFromDatabase(arId).then(data => {
                    if (data) {
                        loadARPortfolio(data);
                    }
                });
                return true;
            }
            
            return false;
        }

        // Load AR Portfolio from QR code data
        function loadARPortfolio(data) {
            // Populate form with loaded data
            if (data.user) {
                document.getElementById('inputName').value = data.user.name || '';
                document.getElementById('inputWorkApplied').value = data.user.position || '';
                document.getElementById('inputAddress').value = data.user.address || '';
                document.getElementById('inputEmail').value = data.user.email || '';
                document.getElementById('inputPhone').value = data.user.phone || '';
                document.getElementById('inputSkills').value = data.user.skills || '';
                document.getElementById('inputYouTube').value = data.user.youtube || '';
                document.getElementById('inputWebsite').value = data.user.website || '';
            }
            
            // Load uploaded files
            if (data.files && data.files.length > 0) {
                uploadedFiles = data.files;
                updateFileDisplay();
                updatePortfolioStats();
            }
            
            // Update preview
            updatePreview();
            
            // Switch to AR test tab
            const arTab = document.getElementById('ar-test-tab');
            if (arTab) {
                arTab.click();
            }
            
            showSuccessMessage('AR Portfolio loaded successfully! Ready to view in AR.');
        }

        // Enhanced AR experience with loaded data
        function enhancedARExperience() {
            // This would set up the AR experience with all the loaded portfolio data
            if (!portfolioData) {
                updatePreview();
            }
            
            startARCamera();
            
            // Auto-start AR experience after a delay
            setTimeout(() => {
                if (portfolioData.files.length > 0) {
                    const hasImages = portfolioData.files.some(f => f.type.startsWith('image/'));
                    const hasVideos = portfolioData.files.some(f => f.type.startsWith('video/'));
                    
                    if (hasImages) {
                        switchARContent('images');
                    } else if (hasVideos) {
                        switchARContent('videos');
                    } else if (currentUser.youtube) {
                        switchARContent('youtube');
                    }
                }
            }, 2000);
        }

        // Navigation between AR content
        function navigateARContent(direction) {
            const contentTypes = [];
            
            // Determine available content types
            const hasImages = uploadedFiles.some(f => f.type.startsWith('image/'));
            const hasVideos = uploadedFiles.some(f => f.type.startsWith('video/'));
            const hasYouTube = currentUser.youtube !== '';
            const hasDocs = uploadedFiles.some(f => f.type.includes('pdf') || f.type.includes('doc'));
            
            if (hasImages) contentTypes.push('images');
            if (hasVideos) contentTypes.push('videos');
            if (hasYouTube) contentTypes.push('youtube');
            if (hasDocs) contentTypes.push('documents');
            contentTypes.push('info');
            
            if (contentTypes.length === 0) return;
            
            const currentIndex = contentTypes.indexOf(arContentType);
            let newIndex;
            
            if (direction === 'next') {
                newIndex = (currentIndex + 1) % contentTypes.length;
            } else {
                newIndex = currentIndex === 0 ? contentTypes.length - 1 : currentIndex - 1;
            }
            
            switchARContent(contentTypes[newIndex]);
        }

        // Keyboard navigation for AR
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('arScene').classList.contains('hidden')) return;
            
            switch(event.key) {
                case 'ArrowLeft':
                    navigateARContent('prev');
                    break;
                case 'ArrowRight':
                    navigateARContent('next');
                    break;
                case 'Escape':
                    stopARCamera();
                    break;
            }
        });

        // Initialize the application when page loads
        window.addEventListener('load', function() {
            // Check if this is an AR view from QR code
            if (checkForARData()) {
                showSuccessMessage('Loading AR portfolio from QR code...');
            }
            
            // Set up periodic updates
            setInterval(function() {
                if (!document.getElementById('arScene').classList.contains('hidden')) {
                    // Update AR content periodically if needed
                    console.log('AR scene active, updating content...');
                }
            }, 5000);
        });

        // Performance optimization for AR
        function optimizeARPerformance() {
            const arScene = document.getElementById('arScene');
            if (!arScene) return;
            
            // Set renderer properties for better performance
            arScene.setAttribute('renderer', 'antialias: false; colorManagement: false');
            arScene.setAttribute('vr-mode-ui', 'enabled: false');
            
            // Optimize for mobile
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                arScene.setAttribute('renderer', 'antialias: false; colorManagement: false; precision: mediump');
            }
        }

        // Call optimization on AR start
        document.addEventListener('DOMContentLoaded', function() {
            optimizeARPerformance();
        });

        // Export functions for external use (if needed)
        window.ARCallingCard = {
            generateQRCode: generateAdvancedQRCode,
            startAR: enhancedARExperience,
            savePortfolio: savePortfolioToDatabase,
            loadPortfolio: loadPortfolioFromDatabase
        };

        console.log('AR Calling Card System Initialized');
        console.log('Available functions:', Object.keys(window.ARCallingCard));
    </script>
</body>
</html>